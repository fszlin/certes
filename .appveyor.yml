version: 2.3.1.{build}
build:
  verbosity: minimal
  project: Certes.sln

skip_tags: true
image: Visual Studio 2017

skip_commits:
  files:
  - '*.md'
  #- '*.yml'

clone_depth: 1
nuget:  
  disable_publish_on_pr: true

environment:
  DOCFX_SOURCE_BRANCH_NAME: master
  GITHUB_ACCESS_TOKEN:
    secure: MZeiiHM6tnTZKRr0x2MsNUK/kOjSKNMZd/48f2uBs8j5bge+JygXE+flTSI16yxC

cache:

branches:
  # whitelist
  only:
    - docs

init:
  - git config --global core.autocrlf input

install:
  - choco install docfx -y

build_script:
  - ps: docfx docs/docfx.json

#test: off
before_test:

on_success:
  # gh-pages
  - ps: |
        git config --global core.autocrlf false
        git config --global credential.helper store
        git config --global user.email ci@certes.app
        git config --global user.name ci
        Add-Content "$env:USERPROFILE\.git-credentials" "https://$($env:GITHUB_ACCESS_TOKEN):x-oauth-basic@github.com`n"
        git clone https://github.com/fszlin/certes.git -b gh-pages gh-pages -q
        Copy-Item ./docs/_site/* ./gh-pages/ -Recurse -Container -Force
        cd gh-pages
        git add -A 2>&1
        git commit -m "ci-$($env:APPVEYOR_BUILD_NUMBER)" -q
        git push origin gh-pages -q
        cd $env:APPVEYOR_BUILD_FOLDER

configuration: Release
