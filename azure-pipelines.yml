trigger:
- master

jobs:

- template: scripts/build.yml
  parameters:
    name: Linux_netstandard20
    displayName: Linux - netstandard2.0
    framework: netstandard2.0
    appFramework: netcoreapp2.0
    pool:
      vmImage: 'ubuntu-latest'

- template: scripts/build.yml
  parameters:
    name: macOS_netstandard20
    displayName: macOS - netstandard2.0
    framework: netstandard2.0
    appFramework: netcoreapp2.0
    pool:
      vmImage: 'macOS-latest'

- template: scripts/build.yml
  parameters:
    name: Windows_netstandard20
    displayName: Windows - netstandard2.0
    framework: netstandard2.0
    appFramework: netcoreapp2.0
    pool:
      vmImage: 'windows-latest'

- template: scripts/build.yml
  parameters:
    name: Windows_net47
    displayName: Windows - net47
    framework: net47
    appFramework: net47
    pool:
      vmImage: 'windows-latest'

- job: pack_preview
  displayName: Pack certes preview
  pool:
    vmImage: 'windows-latest'
  dependsOn:
  - Linux_netstandard20
  - macOS_netstandard20
  - Windows_netstandard20
  - Windows_net47
  
  steps:

  - task: DotNetCoreCLI@2
    displayName: Pack Certes preview
    inputs:
      command: 'pack'
      packagesToPack: 'src/Certes/Certes.csproj'
      arguments: '-p:CertesPreview=true'
      includesymbols: true
      versioningScheme: 'off'

  - task: PublishBuildArtifacts@1
    inputs:
      PathtoPublish: '$(Build.ArtifactStagingDirectory)'
      ArtifactName: 'certes_preview'
      publishLocation: 'Container'

- job: pack
  displayName: Pack Certes
  pool:
    vmImage: 'windows-latest'
  dependsOn:
  - Linux_netstandard20
  - macOS_netstandard20
  - Windows_netstandard20
  - Windows_net47
  
  steps:

  - task: DotNetCoreCLI@2
    displayName: Pack certes
    inputs:
      command: 'pack'
      packagesToPack: 'src/Certes/Certes.csproj'
      includesymbols: true
      versioningScheme: 'off'

  - task: PublishBuildArtifacts@1
    inputs:
      PathtoPublish: '$(Build.ArtifactStagingDirectory)'
      ArtifactName: 'certes'
      publishLocation: 'Container'

- job: pack_tool_preview
  displayName: Pack Certes.Tool preview
  pool:
    vmImage: 'windows-latest'
  dependsOn:
  - Linux_netstandard20
  - macOS_netstandard20
  - Windows_netstandard20
  - Windows_net47
  
  steps:

  - task: DotNetCoreCLI@2
    displayName: Pack certes.tool preview
    inputs:
      command: 'pack'
      packagesToPack: 'src/Certes.Cli/Certes.Cli.csproj'
      arguments: '-p:CertesPreview=true'
      includesymbols: true
      versioningScheme: 'off'

  - task: PublishBuildArtifacts@1
    inputs:
      PathtoPublish: '$(Build.ArtifactStagingDirectory)'
      ArtifactName: 'certes_tool_preview'
      publishLocation: 'Container'

- job: pack_tool
  displayName: Pack Certes.Tool
  pool:
    vmImage: 'windows-latest'
  dependsOn:
  - Linux_netstandard20
  - macOS_netstandard20
  - Windows_netstandard20
  - Windows_net47
  
  steps:

  - task: DotNetCoreCLI@2
    displayName: Pack certes.tool
    inputs:
      command: 'pack'
      packagesToPack: 'src/Certes.Cli/Certes.Cli.csproj'
      includesymbols: true
      versioningScheme: 'off'

  - task: PublishBuildArtifacts@1
    inputs:
      PathtoPublish: '$(Build.ArtifactStagingDirectory)'
      ArtifactName: 'certes_tool'
      publishLocation: 'Container'
