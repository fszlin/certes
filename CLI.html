<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Free certificates using Certes CLI | Certes </title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="title" content="Free certificates using Certes CLI - Certes ">
    <meta name="generator" content="docfx 2.59.4.0">
    
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css" integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4" crossorigin="anonymous">
    <link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-87DrmpqHRiY8hPLIr7ByqhPIywuSsjuQAfMXAE0sMUpY3BM7nXjf+mLIUSvhDArs" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/dracula.min.css">
    <link rel="stylesheet" href="styles/site.css">
    <meta property="docfx:navrel" content="toc.html">
    <meta property="docfx:tocrel" content="api/toc.html">
    
    
    
    <script type="text/javascript">
    var appInsights=window.appInsights||function(a){function b(a){c[a]=function(){var b=arguments;c.queue.push(function(){c[a].apply(c,b)})}}var c={config:a},d=document,e=window;setTimeout(function(){var b=d.createElement("script");b.src=a.url||"https://az416426.vo.msecnd.net/scripts/a/ai.0.js",d.getElementsByTagName("script")[0].parentNode.appendChild(b)});try{c.cookie=d.cookie}catch(a){}c.queue=[];for(var f=["Event","Exception","Metric","PageView","Trace","Dependency"];f.length;)b("track"+f.pop());if(b("setAuthenticatedUserContext"),b("clearAuthenticatedUserContext"),b("startTrackEvent"),b("stopTrackEvent"),b("startTrackPage"),b("stopTrackPage"),b("flush"),!a.disableExceptionTracking){f="onerror",b("_"+f);var g=e[f];e[f]=function(a,b,d,e,h){var i=g&&g(a,b,d,e,h);return!0!==i&&c["_"+f](a,b,d,e,h),i}}return c}({instrumentationKey:"9aaf9896-bee3-4d08-abb6-2ef51b389035"});
    window.appInsights=appInsights,appInsights.queue&&0===appInsights.queue.length&&appInsights.trackPageView();
  </script>
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <div class="bg-light">
        <nav class="navbar navbar-expand-lg navbar-light bg-light container">
          
          <a class="navbar-brand" href="index.html">
            <img id="logo" class="svg" src="images/logo.svg" alt="Certes" width="36" height="36">
          </a>
          <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
        
          <div class="collapse navbar-collapse" id="navbar">
            <!--<form id="search" role="search" class="form-inline my-2 my-lg-0">
              <input id="search-query" class="form-control mr-sm-2" type="search" placeholder="Search" autocomplete="off" aria-label="Search">
            </form>-->
          </div>
        </nav>
        </div>
        
        <div class="bg-dark">
        <nav aria-label="breadcrumb" id="breadcrumb" class="container hide-when-search">
          <!--<ol class="breadcrumb">
            <li class="breadcrumb-item" aria-current="page"></li>
          </ol>-->
        </nav>
        </div>      </header>
      <div role="main" class="container body-content hide-when-search">
      <div class="row">
        
        
        <div class="sidenav hide-when-search col-md-3 pt-md-3 pb-md-3">
          <a class="btn btn-link toc-toggle d-md-none" data-toggle="collapse" data-target="#sidetoggle" href="javascript:;" aria-expanded="true" aria-controls="sidetoggle">
            Show / Hide Table of Contents
          </a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article col-md-9">
      <div class="row">
          <div class="col-lg-9">
            <article class="content wrap pt-2 pb-2" id="_content" data-uid="">
<h1 id="free-certificates-using-certes-cli">Free certificates using Certes CLI</h1>

<p><a href="https://www.nuget.org/packages/dotnet-certes/">Certes CLI</a>
is delivered as a <code>dotnet</code> global tool, and it can be install
using <a href="https://docs.microsoft.com/en-us/dotnet/core/tools/dotnet-tool-install">dotnet tool</a>
command:</p>
<pre><code class="lang-PowerShell">dotnet tool install --global dotnet-certes
</code></pre>
<h2 id="managing-acme-account">Managing ACME account</h2>
<p>An ACME account is needed for generating SSL certificates. If you don't
have one already, you can register a new account:</p>
<pre><code class="lang-PowerShell">certes account new email@example.com
</code></pre>
<p>To use an existing account, simply import your account key:</p>
<pre><code class="lang-PowerShell">certes account set ./account-key.pem
</code></pre>
<p>You may review the current account:</p>
<pre><code class="lang-PowerShell">certes account show
</code></pre>
<p>The result should look similar to this:</p>
<pre><code class="lang-json">{
  &quot;location&quot;: &quot;https://acme-v02.api.letsencrypt.org/acme/acct/1&quot;,
  &quot;resource&quot;: {
    &quot;status&quot;: &quot;valid&quot;,
    &quot;contact&quot;: [
      &quot;mailto:email@example.com&quot;
    ]
  }

</code></pre>
<h2 id="ordering-ssl-certificates">Ordering SSL Certificates</h2>
<p>With an <code>valid</code> ACME account, we can start generating SSL certificates now.</p>
<blockquote>
<p>You may add up to 100 domains in one order, and mixing wildcard and non-wildcard
domains, as long as the domains don't overlap with each other.</p>
</blockquote>
<pre><code class="lang-PowerShell">certes order new *.example.com api.example.net
</code></pre>
<p>Keep note of the order location, which we will use it in the next steps:</p>
<pre><code class="lang-json">{
  &quot;location&quot;: &quot;https://acme-v02.api.letsencrypt.org/acme/order/2/3&quot;,
  &quot;resource&quot;: {
    &quot;status&quot;: &quot;pending&quot;,
    &quot;expires&quot;: &quot;2018-07-03T04:55:04+00:00&quot;,
    &quot;identifiers&quot;: [
      {
        &quot;type&quot;: &quot;dns&quot;,
        &quot;value&quot;: &quot;*.example.com&quot;
      },
      {
        &quot;type&quot;: &quot;dns&quot;,
        &quot;value&quot;: &quot;api.example.net&quot;
      }
    ],
    &quot;authorizations&quot;: [
      &quot;https://acme-v02.api.letsencrypt.org/acme/authz/coHQk9WEhTHTjd9eWFeA2UueKuG8qjBKP3EyVdQXZsk&quot;,
      &quot;https://acme-v02.api.letsencrypt.org/acme/authz/E1MtjxAiM1l_TyK3OWhMR1n9-u3DYOkUVxchzmZ2OaU&quot;
    ],
    &quot;finalize&quot;: &quot;https://acme-v02.api.letsencrypt.org/acme/finalize/2/3&quot;
  }
}
</code></pre>
<h2 id="validating-domain-ownership">Validating Domain Ownership</h2>
<p>We will need to prove that we have control of the domains
we claimed in the order, so the ACME server would issue
the SSL certificate. The ACME server may send varies challenges
for each domain, such as <code>DNS</code>, <code>HTTP</code>, and <code>TLS-ALPN</code>, and we
can fullfill any one of them.</p>
<blockquote>
<p>For wildcard domains, currently only <code>DNS</code> challenge is accepted.</p>
</blockquote>
<h3 id="setup-for-challenges">Setup for Challenges</h3>
<p>Certes CLI provides commands for generating necessary data to fullfill
the challenges.</p>
<h4 id="dns-challenge">DNS challenge</h4>
<p>To get the <code>TXT</code> record value for <code>DNS</code> challenge:</p>
<pre><code class="lang-Powershell">certes order authz https://acme-v02.api.letsencrypt.org/acme/order/2/3 *.example.com dns
</code></pre>
<p>The output will contain the <code>TXT</code> record value.</p>
<pre><code class="lang-json">{
  &quot;...&quot;: &quot;...&quot;,
  &quot;dnsTxt&quot;: &quot;Uil-TOCuvR9qnC7H3V65ossmqPgDERDg_9ahr6ZYBd0&quot;,
  &quot;resource&quot;: &quot;...&quot;
}
</code></pre>
<h4 id="http-01-challenge">HTTP-01 challenge</h4>
<p>To get token and thumbprint value for <code>HTTP-01</code> challenge:</p>
<pre><code class="lang-Powershell">certes order authz https://acme-v02.api.letsencrypt.org/acme/order/2/3 api.example.com http
</code></pre>
<p>The output will contain the two value fields we need to use for order validation.</p>
<pre><code class="lang-json">{
  &quot;location&quot;: &quot;...&quot;,
  &quot;resource&quot;: {
    &quot;type&quot;: &quot;http-01&quot;,
    &quot;url&quot;: &quot;https://acme-v02.api.letsencrypt.org/acme/chall-v3/2645311522/sample&quot;,
    &quot;status&quot;: &quot;Pending&quot;,
    &quot;token&quot;: &quot;iuaJR4CdLFxvt4RsmVsgfSU46rqYsrQpzxasdactest&quot;
  },
  &quot;keyAuthz&quot;: &quot;iuaJR4CdLFxvt4RsmVsgfSU46rqYsrQpzxasdactest.Qed9-4Ek4ot3idslj89tmCMGEYlfY5I463X37hCd9i4&quot;
}
</code></pre>
<p>On your application server you need to create file which will be available under <em><a href="http://api.example.com/.well-known/acme-challenge/iuaJR4CdLFxvt4RsmVsgfSU46rqYsrQpzxasdactest">http://api.example.com/.well-known/acme-challenge/iuaJR4CdLFxvt4RsmVsgfSU46rqYsrQpzxasdactest</a></em> (resource.token value for last url segment). File content needs to be set as <em>iuaJR4CdLFxvt4RsmVsgfSU46rqYsrQpzxasdactest.Qed9-4Ek4ot3idslj89tmCMGEYlfY5I463X37hCd9i4</em> (keyAuthz value).</p>
<!--
TODO: TLS-ALPN-01
-->
<h3 id="configure-dns-challenge-on-azure-dns">Configure DNS challenge on Azure DNS</h3>
<p>If you are using <a href="https://azure.microsoft.com/en-ca/services/dns">Azure DNS</a> service,
you can setup the <code>TXT</code> recod using command:</p>
<pre><code class="lang-PowerShell">certes az dns https://acme-v02.api.letsencrypt.org/acme/order/2/3 `
  --resource-group my-res-grp                                     `
  --subscription-id 00000000-0000-0000-0000-000000000000          `
  --tenant-id 00000000-0000-0000-0000-000000000000                `
  --client-id 00000000-0000-0000-0000-000000000000                `
  --client-secret my-pwd
</code></pre>
<blockquote>
<p>Azure service principal is used to deploy azure resources. If you don't have
one already, follow <a href="https://docs.microsoft.com/en-us/azure/azure-resource-manager/resource-group-create-service-principal-portal?view=azure-cli-latest">these steps</a> to create one, and please ensure the
application has <code>DNS Zone Contributor</code> role assigned.</p>
</blockquote>
<h3 id="completing-challenges">Completing Challenges</h3>
<p>Once the responses for challenges are ready, we can let the ACME service to
perform validation:</p>
<pre><code class="lang-Powershell">certes order validate https://acme-v02.api.letsencrypt.org/acme/order/2/3 *.example.com dns
certes order validate https://acme-v02.api.letsencrypt.org/acme/order/2/3 api.example.net http
</code></pre>
<p>The statuses should now changed to <code>valid</code> for the authorizations of the domains.</p>
<pre><code class="lang-JSON">{
  &quot;identifier&quot;: {
    &quot;type&quot;: &quot;dns&quot;,
    &quot;value&quot;: &quot;*.example.com&quot;
  },
  &quot;status&quot;: &quot;valid&quot;,
  &quot;expires&quot;: &quot;2018-07-24T00:01:32Z&quot;,
  &quot;challenges&quot;: [
    &quot;...&quot;
  ],
  &quot;wildcard&quot;: true
}
</code></pre>
<h2 id="exporting-ssl-certificate">Exporting SSL Certificate</h2>
<p>Once all the domains are validated, we can finilize the order with a random
private key:</p>
<pre><code class="lang-PowerShell">certes order finalize https://acme-v02.api.letsencrypt.org/acme/order/2/3 `
  --out cert-key.pem
</code></pre>
<blockquote>
<p>The <code>--private-key</code> option can be used to specify the private key for the certificate.</p>
</blockquote>
<blockquote>
<p>The <code>--preferred-chain</code> option can be used to specify the preferred root certificate.</p>
</blockquote>
<p>To export the certificate in <code>PEM</code>:</p>
<pre><code class="lang-PowerShell">certes cert pem https://acme-v02.api.letsencrypt.org/acme/order/2/3 `
  --out my-cert.pem --preferred-chain &quot;ISRG X1 Root&quot;
</code></pre>
<p>Or pack the certificate and private key in <code>PFX</code>:</p>
<pre><code class="lang-PowerShell">certes cert pfx https://acme-v02.api.letsencrypt.org/acme/order/2/3 pfx-password `
  --private-key cert-key.pem                                                     `
  --out my-cert.pfx
</code></pre>
<p>That's all, you now have your free SSL certificate ready for deploy.</p>
<h3 id="deploy-ssl-certificate-to-azure-app-services">Deploy SSL Certificate to Azure App Services</h3>
<p>Certes CLI also support for deploying the certificates to <a href="https://azure.microsoft.com/en-us/services/app-service/">Azure App Service</a>, <code>Web App</code> or <code>Function App</code>:</p>
<pre><code class="lang-PowerShell">certes az app https://acme-v02.api.letsencrypt.org/acme/order/2/3 `
  app-svc-name *.example.com                                      `
  --private-key cert-key.pem                                      `
  --resource-group my-res-grp                                     `
  --subscription-id 00000000-0000-0000-0000-000000000000          `
  --tenant-id 00000000-0000-0000-0000-000000000000                `
  --client-id 00000000-0000-0000-0000-000000000000                `
  --client-secret my-pwd
</code></pre>
<blockquote>
<p>The Azure service principal should have <code>Website Contributor</code> role assigned.</p>
</blockquote>
<blockquote>
<p>Use the <code>--slot</code> option to deploy the SSL certificate to non-production slots.</p>
</blockquote>
</article>
            <div id="disqus_thread"></div>
            <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
          </div>
          
          <div class="d-none d-lg-block col-md-3" role="complementary">
            <div class="sideaffix pt-3 pb-3">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/fszlin/certes/blob/main/docs/CLI.md/#L1" class="contribution-link text-info" title="Improve this Doc">
                    <i class="fal fa-edit fa-fw"></i>
                    <span>Improve this Doc</span>
                    </a>
                  </li>
                </ul>
              </div>
              <!--<div class="github-links">
                  <a class="github-button" href="https://github.com/fszlin/certes" data-icon="octicon-star" data-size="large" data-show-count="true" aria-label="Star fszlin/certes on GitHub">Star</a>
              </div>-->
              <nav class="hidden-print affix mt-2" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
          </div>
        </div>
      </div>
      </div>
      
      <footer class="bg-secondary">
        <!--<div class="grad-bottom"></div>-->
        <div class="footer bg-secondary">
          <div class="container">
          <div class="d-flex">
            <div class="p-2 flex-grow-1 text-white">
            &copy; 2018 <a class="text-white" href="https://github.com/fszlin/certes">Certes</a> Project
            
            </div>
            <div class="p-2">
              <a class="text-white" href="#top">Back to top</a>
            </div>
          </div>
          </div>
        </div>
      </footer>
    </div>
    
    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js" integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js" integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.0/anchor.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/dos.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/powershell.min.js"></script>
    <script type="text/javascript" src="styles/docfx.js"></script>
  </body>
</html>
